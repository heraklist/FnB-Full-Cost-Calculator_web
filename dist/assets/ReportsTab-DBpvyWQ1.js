import{b as G,a as O,u as A,c as K,j as e}from"./index-D7UZowsJ.js";import{a as Q}from"./Skeleton-D5FN9Rmh.js";import{r as u}from"./vendor-react-KfUPlHYY.js";import{c as U,g as z}from"./costCalculations-BerXyv4h.js";import"./vendor-supabase-B4amk4rL.js";import"./fixedCosts-Dl8kuOQz.js";function B(){const{events:v,loading:_}=G(),{recipes:x}=O(),{ingredients:j}=A(),{settings:N}=K(),[o,R]=u.useState("month"),[r,C]=u.useState(new Date().getFullYear()),[h,f]=u.useState(new Date().getMonth()),g=Array.from(new Set((v||[]).map(s=>s.event_date&&!isNaN(new Date(s.event_date).getFullYear())?new Date(s.event_date).getFullYear():null).filter(s=>s!==null))).sort((s,t)=>t-s),S=s=>z(s,j,N),b=s=>U(s,x,j,N),d=v.filter(s=>{if(!s.event_date)return!1;const t=new Date(s.event_date),a=t.getFullYear(),n=t.getMonth();if(o==="month")return a===r&&n===h;if(o==="quarter"){const l=Math.floor(h/3),c=Math.floor(n/3);return a===r&&c===l}else return a===r}),m=d.length,T=d.filter(s=>s.status==="completed").length,w=d.filter(s=>s.status==="confirmed").length,y=d.filter(s=>s.status==="cancelled").length,Y=()=>{let s=0,t=0,a=0;d.forEach(c=>{if(c.status==="completed"||c.status==="confirmed"){const i=b(c);i&&(s+=i.total,t+=i.costTotal+i.staffCost+i.transportCost+i.equipmentCost,a+=c.guests)}});const n=s-t,l=s>0?n/s*100:0;return{totalRevenue:s,totalCost:t,profit:n,profitMargin:l,totalGuests:a}},{totalRevenue:E,totalCost:D,profit:q,profitMargin:I,totalGuests:P}=Y(),F=(()=>{const s={};return d.forEach(t=>{(t.status==="completed"||t.status==="confirmed")&&(t.recipes||[]).forEach(a=>{const n=x.find(i=>i.id===a.recipe_id);if(!n)return;s[a.recipe_id]||(s[a.recipe_id]={name:a.recipe_name||"Unknown",count:0,revenue:0}),s[a.recipe_id].count+=a.servings;const l=S(n),c=a.price_override??l.pricePerServing;s[a.recipe_id].revenue+=c*a.servings})}),Object.values(s).sort((t,a)=>a.count-t.count).slice(0,5)})(),p=(()=>{const s={};return v.forEach(t=>{if(!t.event_date||t.status!=="completed"&&t.status!=="confirmed")return;const a=new Date(t.event_date);if(a.getFullYear()!==r)return;const n=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;s[n]||(s[n]={revenue:0,events:0});const l=b(t);l&&(s[n].revenue+=l.total,s[n].events+=1)}),Object.entries(s).sort(([t],[a])=>t.localeCompare(a)).map(([t,a])=>({month:M[parseInt(t.split("-")[1])-1].substring(0,3),...a}))})(),$=Math.max(...p.map(s=>s.revenue),1),M=["Î™Î±Î½Î¿Ï…Î¬ÏÎ¹Î¿Ï‚","Î¦ÎµÎ²ÏÎ¿Ï…Î¬ÏÎ¹Î¿Ï‚","ÎœÎ¬ÏÏ„Î¹Î¿Ï‚","Î‘Ï€ÏÎ¯Î»Î¹Î¿Ï‚","ÎœÎ¬Î¹Î¿Ï‚","Î™Î¿ÏÎ½Î¹Î¿Ï‚","Î™Î¿ÏÎ»Î¹Î¿Ï‚","Î‘ÏÎ³Î¿Ï…ÏƒÏ„Î¿Ï‚","Î£ÎµÏ€Ï„Î­Î¼Î²ÏÎ¹Î¿Ï‚","ÎŸÎºÏ„ÏÎ²ÏÎ¹Î¿Ï‚","ÎÎ¿Î­Î¼Î²ÏÎ¹Î¿Ï‚","Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚"],k=["Î™Î±Î½-ÎœÎ±Ï","Î‘Ï€Ï-Î™Î¿Ï…Î½","Î™Î¿Ï…Î»-Î£ÎµÏ€","ÎŸÎºÏ„-Î”ÎµÎº"];return e.jsxs("div",{className:"reports-container",children:[_&&e.jsx(Q,{lines:10}),e.jsx("h2",{className:"section-title",children:"ğŸ“Š Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚ & Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ¬"}),e.jsxs("div",{className:"period-selectors",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Î ÎµÏÎ¯Î¿Î´Î¿Ï‚:"}),e.jsxs("select",{value:o,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"month",children:"ÎœÎ®Î½Î±Ï‚"}),e.jsx("option",{value:"quarter",children:"Î¤ÏÎ¯Î¼Î·Î½Î¿"}),e.jsx("option",{value:"year",children:"ÎˆÏ„Î¿Ï‚"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"ÎˆÏ„Î¿Ï‚:"}),e.jsx("select",{value:r,onChange:s=>C(parseInt(s.target.value)),children:g.length===0?e.jsx("option",{value:r,children:r}):g.map(s=>e.jsx("option",{value:s,children:s},s))})]}),o==="month"&&e.jsxs("div",{children:[e.jsx("label",{children:"ÎœÎ®Î½Î±Ï‚:"}),e.jsx("select",{value:h,onChange:s=>f(parseInt(s.target.value)),children:M.map((s,t)=>e.jsx("option",{value:t,children:s},t))})]}),o==="quarter"&&e.jsxs("div",{children:[e.jsx("label",{children:"Î¤ÏÎ¯Î¼Î·Î½Î¿:"}),e.jsx("select",{value:Math.floor(h/3)*3,onChange:s=>f(parseInt(s.target.value)),children:k.map((s,t)=>e.jsx("option",{value:t*3,children:s},t))})]})]}),e.jsxs("div",{className:"reports-stats-grid",children:[e.jsxs("div",{className:"reports-stat-card blue",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ“…"}),e.jsx("div",{className:"stat-number",children:m}),e.jsx("div",{className:"stat-label",children:"Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ Events"})]}),e.jsxs("div",{className:"reports-stat-card green",children:[e.jsx("div",{className:"stat-icon",children:"âœ…"}),e.jsx("div",{className:"stat-number",children:T}),e.jsx("div",{className:"stat-label",children:"ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î±"})]}),e.jsxs("div",{className:"reports-stat-card yellow",children:[e.jsx("div",{className:"stat-icon",children:"â³"}),e.jsx("div",{className:"stat-number",children:w}),e.jsx("div",{className:"stat-label",children:"Î•Ï€Î¹Î²ÎµÎ²Î±Î¹Ï‰Î¼Î­Î½Î±"})]}),e.jsxs("div",{className:"reports-stat-card red",children:[e.jsx("div",{className:"stat-icon",children:"âŒ"}),e.jsx("div",{className:"stat-number",children:y}),e.jsx("div",{className:"stat-label",children:"Î‘ÎºÏ…ÏÏ‰Î¼Î­Î½Î±"})]})]}),e.jsxs("div",{className:"reports-financial-grid",children:[e.jsxs("div",{className:"financial-card green",children:[e.jsx("div",{className:"label",children:"Î£Ï…Î½Î¿Î»Î¹ÎºÎ¬ ÎˆÏƒÎ¿Î´Î±"}),e.jsxs("div",{className:"number",children:[E.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"financial-card red",children:[e.jsx("div",{className:"label",children:"Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚"}),e.jsxs("div",{className:"number",children:[D.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"financial-card yellow",children:[e.jsx("div",{className:"label",children:"ÎšÎ±Î¸Î±ÏÏŒ ÎšÎ­ÏÎ´Î¿Ï‚"}),e.jsxs("div",{className:"number",children:[q.toFixed(2)," â‚¬"]})]}),e.jsxs("div",{className:"financial-card purple",children:[e.jsx("div",{className:"label",children:"Î ÎµÏÎ¹Î¸ÏÏÎ¹Î¿ ÎšÎ­ÏÎ´Î¿Ï…Ï‚"}),e.jsxs("div",{className:"number",children:[I.toFixed(1),"%"]})]}),e.jsxs("div",{className:"financial-card cyan",children:[e.jsx("div",{className:"label",children:"Î£Ï…Î½Î¿Î»Î¹ÎºÎ¿Î¯ ÎšÎ±Î»ÎµÏƒÎ¼Î­Î½Î¿Î¹"}),e.jsx("div",{className:"number",children:P})]}),e.jsxs("div",{className:"financial-card blue",children:[e.jsx("div",{className:"label",children:"ÎœÎ­ÏƒÎ¿Ï‚ ÎŒÏÎ¿Ï‚ / Event"}),e.jsxs("div",{className:"number",children:[m>0?(E/m).toFixed(2):"0.00"," â‚¬"]})]})]}),o==="year"&&p.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsxs("h3",{children:["ğŸ“ˆ ÎœÎ·Î½Î¹Î±Î¯Î± Î•Î¾Î­Î»Î¹Î¾Î· ",r]}),e.jsx("div",{className:"chart-container",children:p.map((s,t)=>e.jsxs("div",{className:"chart-bar-wrapper",children:[e.jsxs("div",{className:"chart-bar-value",children:[s.revenue.toFixed(0),"â‚¬"]}),e.jsx("div",{className:"chart-bar",style:{height:`${s.revenue/$*150}px`},children:e.jsx("span",{className:"chart-bar-events",children:s.events})}),e.jsx("div",{className:"chart-bar-label",children:s.month})]},t))})]}),F.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h3",{children:"ğŸ† Top 5 Î£Ï…Î½Ï„Î±Î³Î­Ï‚"}),e.jsx("div",{className:"top-recipes-list",children:F.map((s,t)=>e.jsxs("div",{className:"top-recipe-item",children:[e.jsxs("span",{className:"recipe-rank",children:["#",t+1]}),e.jsx("span",{className:"recipe-name",children:s.name}),e.jsxs("span",{className:"recipe-count",children:[s.count," Î¼ÎµÏÎ¯Î´ÎµÏ‚"]}),e.jsxs("span",{className:"recipe-revenue",children:[s.revenue.toFixed(2)," â‚¬"]})]},t))})]}),m===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx("span",{className:"empty-icon",children:"ğŸ“Š"}),e.jsx("p",{children:"Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Ï„Î·Î½ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÎµÏÎ¯Î¿Î´Î¿"})]})]})}const te=u.memo(B);export{te as default};
