import{j as e,a as se,u as te,R as ie,U as ae}from"./index-D7UZowsJ.js";import{r as o}from"./vendor-react-KfUPlHYY.js";import{S as re}from"./Skeleton-D5FN9Rmh.js";import{u as le,a as ce,P as oe}from"./Pagination-DlkObIsn.js";import{u as de,a as me}from"./useVirtualScrolling-3HgXsM7l.js";import{u as ue}from"./Toast-Clw7ASqT.js";import"./vendor-supabase-B4amk4rL.js";function ge({recipe:s,onEdit:v,onDelete:d,onDuplicate:f,onScale:p}){return e.jsxs("div",{className:"recipe-card card bg-surface rounded-lg shadow-md p-5 animate-fade-in transition-all hover:shadow-lg hover:-translate-y-1 duration-200",tabIndex:0,style:{"--card-shadow":"var(--shadow-md)"},children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"m-0 text-lg font-semibold text-primary-900",children:s.name}),e.jsx("span",{className:"category-badge px-2 py-1 rounded text-xs font-bold bg-primary-100 text-primary-700",children:s.category})]}),e.jsxs("div",{className:"flex gap-4 text-xs text-muted-700 mb-2",children:[e.jsxs("span",{children:["ğŸ½ï¸ ",s.servings," Î¼ÎµÏÎ¯Î´ÎµÏ‚"]}),e.jsxs("span",{children:["â±ï¸ ",s.prep_time_minutes," Î»ÎµÏ€Ï„Î¬"]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Î¥Î»Î¹ÎºÎ¬:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm mt-1",children:[(s.ingredients||[]).slice(0,4).map((x,y)=>e.jsxs("li",{children:[x.ingredient_name," - ",x.quantity," ",x.unit]},y)),(s.ingredients||[]).length>4&&e.jsxs("li",{className:"text-xs text-muted-500",children:["+",(s.ingredients||[]).length-4," Î±ÎºÏŒÎ¼Î±..."]})]})]}),e.jsx("div",{className:"mb-2"}),e.jsxs("div",{className:"flex gap-2 mt-2 pt-2 border-t border-t-divider",children:[e.jsx("button",{className:"btn-icon",onClick:()=>p(s),title:"ÎšÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ·","aria-label":"ÎšÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ·",children:"âš–ï¸"}),e.jsx("button",{className:"btn-icon",onClick:()=>f(s.id),title:"Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®","aria-label":"Î‘Î½Ï„Î¹Î³ÏÎ±Ï†Î®",children:"ğŸ“‹"}),e.jsx("button",{className:"btn-secondary",onClick:()=>v(s),"aria-label":"Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±",children:"âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±"}),e.jsx("button",{className:"btn-danger",onClick:()=>d(s.id),"aria-label":"Î”Î¹Î±Î³ÏÎ±Ï†Î®",children:"ğŸ—‘ï¸"})]})]})}function he({items:s,renderItem:v,columnCount:d,rowHeight:f,gap:p=16,className:x=""}){const y=o.useRef(null),b=o.useMemo(()=>{const m=[];for(let u=0;u<s.length;u+=d)m.push(s.slice(u,u+d));return m},[s,d]),l=de({count:b.length,getScrollElement:()=>y.current,estimateSize:()=>f+p,overscan:2}),k=l.getVirtualItems();return s.length===0?e.jsx("div",{className:`virtual-grid-empty ${x}`,children:e.jsx("p",{children:"Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±"})}):e.jsx("div",{ref:y,className:`virtual-grid-container h-full overflow-auto ${x}`,children:e.jsx("div",{style:{height:`${l.getTotalSize()}px`,width:"100%",position:"relative"},children:k.map(m=>e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${m.size-p}px`,transform:`translateY(${m.start}px)`,display:"grid",gridTemplateColumns:`repeat(${d}, 1fr)`,gap:`${p}px`},children:b[m.index].map((u,N)=>e.jsx("div",{children:v(u,m.index*d+N)},N))},m.key))})})}function pe(){const{recipes:s,loading:v,error:d,createRecipe:f,updateRecipe:p,deleteRecipe:x,refresh:y}=se(),{ingredients:b}=te(),{showToast:l,showConfirm:k}=ue(),{recordUpdate:m}=le();console.log("showConfirm available:",typeof k);const[u,N]=o.useState(!1),[_,q]=o.useState(null),[C,z]=o.useState(""),[I,E]=o.useState(""),[g,F]=o.useState(null),[j,D]=o.useState(1),[t,h]=o.useState({name:"",category:"Î†Î»Î»Î¿",servings:1,prep_time_minutes:0,notes:"",ingredients:[]}),[c,P]=o.useState({ingredient_id:0,quantity:0,unit:"g"}),T=n=>{n.id&&(console.log("Delete clicked for:",n.id,n.name),k(`Î”Î¹Î±Î³ÏÎ±Ï†Î® "${n.name}";`,()=>{console.log("Confirm clicked, deleting:",n.id),x(n.id)},()=>{console.log("Cancel clicked")}))},S=o.useMemo(()=>s.filter(n=>{const i=C===""||n.name.toLowerCase().includes(C.toLowerCase())||(n.ingredients||[]).some(r=>{var w;return(w=r.ingredient_name)==null?void 0:w.toLowerCase().includes(C.toLowerCase())}),a=I===""||n.category===I;return i&&a}),[s,C,I]),{shouldVirtualize:$}=me(S.length),{currentPageData:L,currentPage:M,totalPages:V,pageSize:O,pageSizeOptions:Q,rangeDisplay:U,isFirstPage:H,isLastPage:A,goToPage:G,setPageSize:J}=ce(S,{initialPageSize:12,pageSizeOptions:[6,12,24,48]}),Y=[...new Set(s.map(n=>n.category))].sort(),R=()=>{h({name:"",category:"Î†Î»Î»Î¿",servings:1,prep_time_minutes:0,notes:"",ingredients:[]}),q(null),N(!1)},B=n=>{h({id:n.id,name:n.name,category:n.category,servings:n.servings,prep_time_minutes:n.prep_time_minutes,notes:n.notes||"",ingredients:(n.ingredients||[]).map(i=>{var a;return{...i,ingredient_name:i.ingredient_name||((a=b.find(r=>r.id===i.ingredient_id))==null?void 0:a.name)}})}),q(n.id),N(!0)},K=async n=>{const i=s.find(r=>r.id===n);if(!i)return;const a={...i,id:void 0,name:`${i.name} (Î‘Î½Ï„Î¯Î³ÏÎ±Ï†Î¿)`};try{await f(a),l("Î— ÏƒÏ…Î½Ï„Î±Î³Î® Î±Î½Ï„Î¹Î³ÏÎ¬Ï†Î·ÎºÎµ!","success")}catch{l("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î®","error")}},W=n=>{F({recipeId:n.id,recipeName:n.name,currentServings:n.servings}),D(n.servings)},X=async()=>{if(!g)return;const n=s.find(r=>r.id===g.recipeId);if(!n)return;const i=j/n.servings,a={...n,servings:j,ingredients:(n.ingredients||[]).map(r=>({...r,quantity:Number((r.quantity*i).toFixed(3))}))};try{await p(a),l("Î— ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ!","success"),F(null)}catch{l("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ·","error")}},Z=()=>{if(c.ingredient_id===0||c.quantity<=0){alert("Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï…Î»Î¹ÎºÏŒ ÎºÎ±Î¹ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±");return}const n=b.find(a=>a.id===c.ingredient_id),i={ingredient_id:c.ingredient_id,ingredient_name:n==null?void 0:n.name,quantity:c.quantity,unit:c.unit};h({...t,ingredients:[...t.ingredients||[],i]}),P({ingredient_id:0,quantity:0,unit:"g"})},ee=n=>{const i=[...t.ingredients||[]];i.splice(n,1),h({...t,ingredients:i})},ne=async n=>{if(n.preventDefault(),!t.ingredients||t.ingredients.length===0){l("Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î± Ï…Î»Î¹ÎºÏŒ","warning");return}if(t.ingredients.find(a=>typeof a.quantity!="number"||a.quantity<=0)){l("ÎŒÎ»ÎµÏ‚ Î¿Î¹ Ï€Î¿ÏƒÏŒÏ„Î·Ï„ÎµÏ‚ Ï…Î»Î¹ÎºÏÎ½ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î¸ÎµÏ„Î¹ÎºÎ­Ï‚.","warning");return}try{_?(await p(t),l("Î— ÏƒÏ…Î½Ï„Î±Î³Î® ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ!","success"),m("recipe",_.toString(),JSON.stringify(t))):(await f(t),l("Î— ÏƒÏ…Î½Ï„Î±Î³Î® Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ!","success")),R()}catch{l("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·","error")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolbar",children:[e.jsx("button",{className:"btn-primary",onClick:()=>{R(),N(!u)},children:u?"âœ• ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿":"+ ÎÎ­Î± Î£Ï…Î½Ï„Î±Î³Î®"}),e.jsx("button",{className:"btn-secondary",onClick:y,children:"ğŸ”„"})]}),e.jsxs("div",{className:"search-bar",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("span",{className:"search-icon",children:"ğŸ”"}),e.jsx("input",{type:"text",placeholder:"Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® Ï…Î»Î¹ÎºÎ¿Ï...",value:C,onChange:n=>z(n.target.value),className:"search-input"}),C&&e.jsx("button",{className:"btn-icon clear-search",onClick:()=>z(""),children:"âœ•"})]}),e.jsxs("select",{value:I,onChange:n=>E(n.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯ÎµÏ‚"}),Y.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsxs("span",{className:"results-count",children:[S.length," / ",s.length]})]}),u&&e.jsxs("form",{onSubmit:ne,className:"form",children:[e.jsx("h3",{className:"form-title",children:_?"âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î£Ï…Î½Ï„Î±Î³Î®Ï‚":"â• ÎÎ­Î± Î£Ï…Î½Ï„Î±Î³Î®"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{htmlFor:"recipe-name",children:"ÎŒÎ½Î¿Î¼Î± Î£Ï…Î½Ï„Î±Î³Î®Ï‚:"}),e.jsx("input",{id:"recipe-name",type:"text",value:t.name,onChange:n=>h({...t,name:n.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"recipe-category",children:"ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±:"}),e.jsx("select",{id:"recipe-category",value:t.category,onChange:n=>h({...t,category:n.target.value}),children:ie.map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"recipe-servings",children:"ÎœÎµÏÎ¯Î´ÎµÏ‚:"}),e.jsx("input",{id:"recipe-servings",type:"number",min:"1",value:t.servings,onChange:n=>h({...t,servings:parseInt(n.target.value)||1})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"recipe-prep-time",children:"Î§ÏÏŒÎ½Î¿Ï‚ (Î»ÎµÏ€Ï„Î¬):"}),e.jsx("input",{id:"recipe-prep-time",type:"number",min:"0",value:t.prep_time_minutes,onChange:n=>h({...t,prep_time_minutes:parseInt(n.target.value)||0})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"recipe-notes",children:"Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚:"}),e.jsx("textarea",{id:"recipe-notes",value:t.notes||"",onChange:n=>h({...t,notes:n.target.value}),rows:2})]}),e.jsxs("div",{className:"ingredients-section",children:[e.jsx("h3",{children:"Î¥Î»Î¹ÎºÎ¬ Î£Ï…Î½Ï„Î±Î³Î®Ï‚"}),e.jsxs("div",{className:"add-ingredient-row",children:[e.jsxs("select",{value:c.ingredient_id,onChange:n=>P({...c,ingredient_id:parseInt(n.target.value)}),children:[e.jsx("option",{value:0,children:"-- Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï…Î»Î¹ÎºÏŒ --"}),b.map(n=>e.jsxs("option",{value:n.id,children:[n.name," (",n.price.toFixed(2),"â‚¬/",n.unit,")"]},n.id))]}),e.jsx("input",{type:"number",step:"0.001",min:"0",placeholder:"Î Î¿ÏƒÏŒÏ„Î·Ï„Î±",value:c.quantity||"",onChange:n=>P({...c,quantity:parseFloat(n.target.value)||0})}),e.jsx("select",{value:c.unit,onChange:n=>P({...c,unit:n.target.value}),children:ae.map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("button",{type:"button",onClick:Z,children:"â•"})]}),t.ingredients&&t.ingredients.length>0&&e.jsx("ul",{className:"ingredient-list",children:t.ingredients.map((n,i)=>e.jsxs("li",{children:[e.jsxs("span",{children:[n.ingredient_name," - ",n.quantity," ",n.unit]}),e.jsx("button",{type:"button",className:"btn-icon",onClick:()=>ee(i),children:"âœ•"})]},i))})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-primary",children:_?"ğŸ’¾ Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·":"ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·"}),_&&e.jsx("button",{type:"button",className:"btn-secondary",onClick:R,children:"Î‘ÎºÏÏÏ‰ÏƒÎ·"})]})]}),v&&e.jsx(re,{count:6}),d&&e.jsxs("p",{className:"error",children:["Î£Ï†Î¬Î»Î¼Î±: ",d]}),(()=>{const r=w=>e.jsx(ge,{recipe:w,onEdit:B,onDelete:()=>T(w),onDuplicate:K,onScale:W},w.id);return $?e.jsx(he,{items:S,renderItem:r,columnCount:3,rowHeight:320,gap:24,className:"virtual-recipes-grid"}):e.jsxs("div",{className:"recipes-grid",children:[L.map(r),S.length===0&&!v&&e.jsx("div",{className:"no-data",children:"Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÏƒÏ…Î½Ï„Î±Î³Î­Ï‚."})]})})(),S.length>0&&e.jsx(oe,{currentPage:M,totalPages:V,pageSize:O,pageSizeOptions:Q,rangeDisplay:U,isFirstPage:H,isLastPage:A,onPageChange:G,onPageSizeChange:J}),g&&e.jsx("div",{className:"modal-overlay",onClick:()=>F(null),children:e.jsxs("div",{className:"modal",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{children:"âš–ï¸ ÎšÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Î£Ï…Î½Ï„Î±Î³Î®Ï‚"}),e.jsx("p",{className:"modal-subtitle",children:g.recipeName}),e.jsx("div",{className:"scale-info",children:e.jsxs("span",{children:["Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ Î¼ÎµÏÎ¯Î´ÎµÏ‚: ",e.jsx("strong",{children:g.currentServings})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ÎÎ­ÎµÏ‚ Î¼ÎµÏÎ¯Î´ÎµÏ‚:"}),e.jsx("input",{type:"number",min:"1",value:j,onChange:n=>D(parseInt(n.target.value)||1),autoFocus:!0})]}),j!==g.currentServings&&e.jsxs("div",{className:"scale-preview",children:[e.jsx("span",{children:"Î£Ï…Î½Ï„ÎµÎ»ÎµÏƒÏ„Î®Ï‚: "}),e.jsxs("strong",{children:[(j/g.currentServings).toFixed(2),"x"]}),e.jsxs("p",{className:"scale-note",children:["ÎŸÎ¹ Ï€Î¿ÏƒÏŒÏ„Î·Ï„ÎµÏ‚ Ï…Î»Î¹ÎºÏÎ½ Î¸Î± ",j>g.currentServings?"Î±Ï…Î¾Î·Î¸Î¿ÏÎ½":"Î¼ÎµÎ¹Ï‰Î¸Î¿ÏÎ½"]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>F(null),children:"Î‘ÎºÏÏÏ‰ÏƒÎ·"}),e.jsx("button",{className:"btn-primary",onClick:X,disabled:j===g.currentServings,children:"âš–ï¸ Î•Ï†Î±ÏÎ¼Î¿Î³Î®"})]})]})})]})}const Ce=o.memo(pe);export{Ce as default};
