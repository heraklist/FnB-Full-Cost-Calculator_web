import{j as e}from"./index-D7UZowsJ.js";import{r as d}from"./vendor-react-KfUPlHYY.js";import{getUsers as g,checkSuperAdmin as b,updateUserRole as c}from"./tauri-vzOShXsj.js";import{u as A}from"./Toast-Clw7ASqT.js";import"./vendor-supabase-B4amk4rL.js";const v=()=>{const[o,m]=d.useState([]),[h,l]=d.useState(!0),[r,p]=d.useState(!1),{showToast:a}=A(),t=async()=>{try{l(!0);const[s,n]=await Promise.all([g(),b()]);m(s),p(n)}catch{a("Failed to load users","error")}finally{l(!1)}};d.useEffect(()=>{t()},[]);const x=async s=>{const i=s.roles.includes("admin")?"remove":"add";if(!r&&(s.roles.includes("super_admin")||s.roles.includes("admin"))){a("Only Super Admins can manage admin roles","error");return}try{await c(s.id,"admin",i),a(`User ${s.name} is ${i==="add"?"now":"no longer"} an admin`,"success"),t()}catch{a("Failed to update role","error")}},u=async s=>{if(!r)return;const i=s.roles.includes("super_admin")?"remove":"add";try{await c(s.id,"super_admin",i),a(`User ${s.name} is ${i==="add"?"now":"no longer"} a Super Admin`,"success"),t()}catch{a("Failed to update super admin role","error")}};return h?e.jsxs("div",{className:"tab-loader",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading Users..."})]}):e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"tab-header",children:[e.jsxs("h2",{children:["ðŸ‘¥ User Management ",r&&e.jsx("span",{className:"badge badge-warning",children:"Super Admin Mode"})]}),e.jsx("button",{className:"btn-secondary",onClick:t,children:"ðŸ”„ Refresh"})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Joined"}),e.jsx("th",{children:"Last Login"}),e.jsx("th",{children:"Roles"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{children:s.lastLoginAt?new Date(s.lastLoginAt).toLocaleDateString():"-"}),e.jsx("td",{children:s.roles.map(n=>e.jsx("span",{className:`badge ${n==="super_admin"?"badge-warning":"badge-primary"}`,style:{marginRight:"5px"},children:n},n))}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn-sm ${s.roles.includes("admin")?"btn-danger":"btn-primary"}`,onClick:()=>x(s),children:s.roles.includes("admin")?"Remove Admin":"Make Admin"}),e.jsx("button",{className:`btn-sm ${s.roles.includes("super_admin")?"btn-danger":"btn-warning"}`,onClick:()=>u(s),style:{marginLeft:"5px"},children:s.roles.includes("super_admin")?"Remove Super":"Make Super"})]}),!r&&e.jsx("span",{className:"text-muted",children:"View Only"})]})})]},s.id))})]})})]})};export{v as default};
